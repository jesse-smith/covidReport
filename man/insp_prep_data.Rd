% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/inspections_table.R
\name{insp_prep_data}
\alias{insp_prep_data}
\title{Prepare Inspections Data for Displaying in HTML Table}
\usage{
insp_prep_data(.data)
}
\arguments{
\item{.data}{A data frame containing the inspections data}
}
\value{
The processed data frame
}
\description{
\code{insp_prep_data()} prepares data from the inspections team for display
as an HTML table. It selects, transforms, orders, and sorts the five columns
needed for display and outputs a visualization-ready dataset.
}
\details{
\code{insp_prep_data()} chains together a number of operations on the input
data.

First, columns are selected as defined in the \strong{Details} of
\code{\link[covidReport:insp_cols_exist]{insp_cols_exist()}};
if multiple columns match this selection, they are
\code{\link[coviData:coalesce_across]{coalesced}}.

Second, columns are transformed according to type and assigned a standard
name. Visit date and closure date are assigned to \code{dt_visit} and \code{dt_closed},
respecively, and converted to the ISO 8601 standard (see
\code{\link[janitor:convert_to_date]{convert_to_date()}},
\code{
\link[covidReport:insp_cast_chr_date]{insp_cast_chr_date()}
}, and
\code{
\link[covidReport:insp_replace_year_long]{
insp_replace_year_long()
}}). Name and address columns are assigned to \code{nm_business} and
\code{addr_business}, respectively, and converted to character with
extra whitespace removed. The number of violations is assigned to
\code{n_violations} and converted to integer.

Third, rows missing a business name or number of violations (\code{nm_business}
or \code{n_violations}) are removed from the dataset. Entries without names are
not easily identifiable, and the primary purpose of the table is to display
violations.

Fourth, columns are reordered for ease of viewing, and unnecessary columns
(any not listed above) are dropped. The ordering is \code{n_violations},
\code{nm_business}, \code{addr_business}, \code{dt_visit}, and \code{dt_closed}.

Last, rows are arranged by column from left to right (first by
\code{n_violations}, then by \code{nm_business}, and so on). \code{n_violations},
\code{dt_visit}, and \code{dt_closed} are arranged in descending order (most violations
and most recent dates first); \code{nm_business} and \code{addr_business} are arranged
in ascending order (aka alphabetically).
}
\seealso{
Other functions in the inspections data pipeline (
\code{
  \link[covidReport:insp_load_data]{insp_load_data()}
  },
\code{
  \link[covidReport:insp_create_table]{insp_create_table()}
  },
\code{
  \link[covidReport:insp_save_table]{insp_save_table()}
  },
\code{
  \link[covidReport:insp_archive_table]{insp_archive_table()}
  }) and the wrapper for the full workflow
(\code{
  \link[covidReport:insp_table_pipeline]{insp_table_pipeline()}
  })
}
